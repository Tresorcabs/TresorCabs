name: ğŸ¤– Update README quotidien

on:
  push:
    branches: [ main, master ] # SpÃ©cifier les branches explicitement
  workflow_dispatch:
  schedule:
    # Tous les jours Ã  7h04 UTC (dÃ©calage de quelques minutes pour Ã©viter la congestion)
    - cron: '7 7 * * *'
    
# Ã‰viter les exÃ©cutions simultanÃ©es
concurrency:
  group: readme-update
  cancel-in-progress: false
    
permissions:
  contents: write
  actions: write
  
jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4 # Version plus rÃ©cente
        with:
          fetch-depth: 0 # RÃ©cupÃ©rer tout l'historique
          
      - name: ğŸ”§ Use Node.js 20.x
        uses: actions/setup-node@v4 # Version plus rÃ©cente
        with:
          node-version: '20.x'
          # Pas de cache si pas de package.json
          
      - name: ğŸ“¦ Install dependencies (si nÃ©cessaire)
        run: |
          # VÃ©rifier si package.json existe avant d'installer
          if [ -f package.json ]; then
            echo "ğŸ“¦ Installation des dÃ©pendances..."
            npm ci
          else
            echo "â„¹ï¸ Pas de package.json trouvÃ©, utilisation de Node.js vanilla"
          fi
          
      - name: ğŸ“Š Generate updated README.md
        run: |
          # VÃ©rifier que le script existe
          if [ ! -f update-readme.js ]; then
            echo "âŒ Fichier update-readme.js introuvable"
            exit 1
          fi
          
          # GÃ©nÃ©rer le nouveau README
          node update-readme.js > README.md
          
          # VÃ©rifier que le fichier a Ã©tÃ© gÃ©nÃ©rÃ©
          if [ ! -s README.md ]; then
            echo "âŒ README.md vide ou non gÃ©nÃ©rÃ©"
            exit 1
          fi
          
          echo "âœ… README.md gÃ©nÃ©rÃ© avec succÃ¨s"
        env:
          CI: true
          TZ: Europe/Paris # DÃ©finir le fuseau horaire
          
      - name: ğŸ” Check for changes
        id: verify-changed-files
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            echo "changed=true" >> $GITHUB_OUTPUT
            echo "âœ… Des changements ont Ã©tÃ© dÃ©tectÃ©s"
          else
            echo "changed=false" >> $GITHUB_OUTPUT
            echo "â„¹ï¸ Aucun changement dÃ©tectÃ©"
          fi
          
      - name: ğŸ“¤ Commit changes
        if: steps.verify-changed-files.outputs.changed == 'true'
        uses: EndBug/add-and-commit@v9
        with:
          author_name: Cabs-Bot
          author_email: tresorbio16@gmail.com
          force: false
          signoff: false
          message: 'ğŸ¤– README.md mis Ã  jour automatiquement par Cabs - $(date -u +"%Y-%m-%d %H:%M UTC")'
          add: 'README.md'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ğŸ“ Log execution
        run: |
          echo "ğŸ• ExÃ©cution terminÃ©e Ã  $(date -u +"%Y-%m-%d %H:%M:%S UTC")"
          echo "ğŸ“Š Status: ${{ job.status }}"