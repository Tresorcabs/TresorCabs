name: ğŸ¤– Mise Ã  jour quotidienne du README

on:
  schedule:
    # Tous les jours Ã  7h UTC (8h en heure franÃ§aise en hiver, 9h en Ã©tÃ©)
    - cron: '0 7 * * *'
  
  # Permet de lancer manuellement l'action
  workflow_dispatch:

permissions:
  contents: write
  actions: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout du repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    
    - name: ğŸ”§ Configuration de Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: ğŸ“Š VÃ©rification des fichiers
      run: |
        echo "ğŸ“ Fichiers prÃ©sents :"
        ls -la
        echo "ğŸ“„ Contenu actuel du README :"
        head -5 README.md || echo "Pas de README trouvÃ©"
        
    - name: ğŸ¯ ExÃ©cution du script de mise Ã  jour
      run: |
        echo "ğŸš€ Lancement du script..."
        node update-readme.js
        echo "âœ… Script terminÃ©"
        
    - name: ğŸ“‹ VÃ©rification des changements
      id: verify-changed-files
      run: |
        echo "ğŸ” VÃ©rification des modifications..."
        if git diff --quiet; then
          echo "âŒ Aucun changement dÃ©tectÃ©"
          echo "changed=false" >> $GITHUB_OUTPUT
        else
          echo "âœ… Changements dÃ©tectÃ©s !"
          echo "ğŸ“ DÃ©tails des modifications :"
          git diff --name-only
          echo "changed=true" >> $GITHUB_OUTPUT
        fi
        
    - name: ğŸ¨ Ajout de modifications crÃ©atives (si pas de changements)
      if: steps.verify-changed-files.outputs.changed == 'false'
      run: |
        echo "ğŸ² Ajout de modifications crÃ©atives..."
        
        # Ajouter un timestamp invisible en commentaire
        TIMESTAMP=$(date +"%Y%m%d%H%M%S")
        echo "<!-- Updated: $TIMESTAMP -->" >> README.md
        
        # Modifier lÃ©gÃ¨rement un espace ou caractÃ¨re invisible
        sed -i "s/DerniÃ¨re mise Ã  jour automatique/DerniÃ¨re mise Ã  jour automatique/g" README.md
        
        echo "âœ¨ Modifications crÃ©atives ajoutÃ©es"
        git diff
        
    - name: âš™ï¸ Configuration Git
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
    - name: ğŸ“¤ Commit et Push des modifications
      run: |
        echo "ğŸ“ Staging des fichiers..."
        git add README.md
        
        # VÃ©rifier s'il y a des changements staged
        if git diff --staged --quiet; then
          echo "âŒ Aucun changement Ã  commiter aprÃ¨s staging"
          exit 0
        else
          echo "âœ… Changements staged dÃ©tectÃ©s, commit en cours..."
          
          # Messages de commit variÃ©s
          MESSAGES=(
            "ğŸ¤– Mise Ã  jour quotidienne du profil"
            "ğŸ“Š Actualisation des stats et donnÃ©es"
            "âœ¨ Refresh automatique du README"
            "ğŸ”„ Synchronisation quotidienne"
            "ğŸ“ˆ Mise Ã  jour des mÃ©triques"
            "ğŸŒŸ Actualisation du profil"
            "ğŸš€ Update automatique quotidien"
            "ğŸ’« Refresh des informations"
          )
          
          # SÃ©lectionner un message alÃ©atoire
          RANDOM_MESSAGE=${MESSAGES[$RANDOM % ${#MESSAGES[@]}]}
          
          echo "ğŸ’¬ Message de commit : $RANDOM_MESSAGE"
          git commit -m "$RANDOM_MESSAGE"
          
          echo "ğŸš€ Push vers GitHub..."
          git push
          
          echo "ğŸ‰ Commit et push rÃ©ussis !"
        fi
        
    - name: ğŸ“Š RÃ©capitulatif
      if: always()
      run: |
        echo "ğŸ“‹ RÃ‰CAPITULATIF DE L'EXÃ‰CUTION"
        echo "================================"
        echo "ğŸ“… Date : $(date)"
        echo "ğŸ”— Repository : ${{ github.repository }}"
        echo "ğŸŒ¿ Branche : ${{ github.ref_name }}"
        echo "ğŸ‘¤ Acteur : ${{ github.actor }}"
        echo "ğŸ¯ Event : ${{ github.event_name }}"
        
        # VÃ©rifier le dernier commit
        echo "ğŸ“ Dernier commit :"
        git log -1 --oneline || echo "Impossible de rÃ©cupÃ©rer le dernier commit"
        
        echo "âœ… Action terminÃ©e avec succÃ¨s !"
